"use strict";

exports.__esModule = true;
exports.default = void 0;
exports.render = render;

var _vue = require("vue");

var _components = require("../utils/components");

var _elements = require("../utils/elements");

var _provide = require("../form/provide");

var _props = require("./props");

var _formDetails = _interopRequireDefault(require("../form-details"));

var _loading = _interopRequireDefault(require("../loading"));

var _ripple = _interopRequireDefault(require("../ripple"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var {
  n,
  classes
} = (0, _components.createNamespace)('switch');

function render(_ctx, _cache) {
  var _component_var_loading = (0, _vue.resolveComponent)("var-loading");

  var _component_var_form_details = (0, _vue.resolveComponent)("var-form-details");

  var _directive_ripple = (0, _vue.resolveDirective)("ripple");

  return (0, _vue.openBlock)(), (0, _vue.createElementBlock)("div", {
    class: (0, _vue.normalizeClass)(_ctx.n())
  }, [(0, _vue.createElementVNode)("div", {
    class: (0, _vue.normalizeClass)(_ctx.classes(_ctx.n('block'), [_ctx.disabled || _ctx.formDisabled, _ctx.n('--disable')])),
    onClick: _cache[0] || (_cache[0] = function () {
      return _ctx.switchActive && _ctx.switchActive(...arguments);
    }),
    style: (0, _vue.normalizeStyle)(_ctx.styleComputed.switch)
  }, [(0, _vue.createElementVNode)("div", {
    style: (0, _vue.normalizeStyle)(_ctx.styleComputed.track),
    class: (0, _vue.normalizeClass)(_ctx.classes(_ctx.n('track'), [_ctx.modelValue === _ctx.activeValue, _ctx.n('track--active')], [_ctx.errorMessage, _ctx.n('track--error')]))
  }, null, 6
  /* CLASS, STYLE */
  ), (0, _vue.withDirectives)(((0, _vue.openBlock)(), (0, _vue.createElementBlock)("div", {
    class: (0, _vue.normalizeClass)(_ctx.classes(_ctx.n('ripple'), [_ctx.modelValue === _ctx.activeValue, _ctx.n('ripple--active')])),
    style: (0, _vue.normalizeStyle)(_ctx.styleComputed.ripple)
  }, [(0, _vue.createElementVNode)("div", {
    style: (0, _vue.normalizeStyle)(_ctx.styleComputed.handle),
    class: (0, _vue.normalizeClass)(_ctx.classes(_ctx.n('handle'), 'var-elevation--2', [_ctx.modelValue === _ctx.activeValue, _ctx.n('handle--active')], [_ctx.errorMessage, _ctx.n('handle--error')]))
  }, [_ctx.loading ? ((0, _vue.openBlock)(), (0, _vue.createBlock)(_component_var_loading, {
    key: 0,
    radius: _ctx.radius
  }, null, 8
  /* PROPS */
  , ["radius"])) : (0, _vue.createCommentVNode)("v-if", true)], 6
  /* CLASS, STYLE */
  )], 6
  /* CLASS, STYLE */
  )), [[_directive_ripple, {
    disabled: !_ctx.ripple || _ctx.disabled || _ctx.loading || _ctx.formDisabled
  }]])], 6
  /* CLASS, STYLE */
  ), (0, _vue.createVNode)(_component_var_form_details, {
    "error-message": _ctx.errorMessage
  }, null, 8
  /* PROPS */
  , ["error-message"])], 2
  /* CLASS */
  );
}

var _default = (0, _vue.defineComponent)({
  render,
  name: 'VarSwitch',
  components: {
    VarLoading: _loading.default,
    VarFormDetails: _formDetails.default
  },
  directives: {
    Ripple: _ripple.default
  },
  props: _props.props,

  setup(props) {
    var {
      bindForm,
      form
    } = (0, _provide.useForm)();
    var {
      errorMessage,
      validateWithTrigger: vt,
      validate: v,
      resetValidation
    } = (0, _components.useValidation)();

    var validate = () => v(props.rules, props.modelValue);

    var validateWithTrigger = () => (0, _vue.nextTick)(() => vt(['onChange'], 'onChange', props.rules, props.modelValue));

    var styleComputed = (0, _vue.computed)(() => {
      var {
        size,
        modelValue,
        color,
        closeColor,
        loadingColor,
        activeValue
      } = props;
      return {
        handle: {
          width: (0, _elements.multiplySizeUnit)(size),
          height: (0, _elements.multiplySizeUnit)(size),
          backgroundColor: modelValue === activeValue ? color || '' : closeColor || '',
          color: loadingColor && loadingColor
        },
        ripple: {
          left: modelValue === activeValue ? (0, _elements.multiplySizeUnit)(size, 0.5) : "-" + (0, _elements.multiplySizeUnit)(size, 0.5),
          color: modelValue === activeValue ? color || '' : closeColor || '#999',
          width: (0, _elements.multiplySizeUnit)(size, 2),
          height: (0, _elements.multiplySizeUnit)(size, 2)
        },
        track: {
          height: (0, _elements.multiplySizeUnit)(size, 0.72),
          width: (0, _elements.multiplySizeUnit)(size, 1.9),
          borderRadius: (0, _elements.multiplySizeUnit)(size, 2 / 3),
          filter: modelValue === activeValue || errorMessage != null && errorMessage.value ? 'opacity(.6)' : 'brightness(.6)',
          backgroundColor: modelValue === activeValue ? color || '' : closeColor || ''
        },
        switch: {
          height: (0, _elements.multiplySizeUnit)(size, 1.2),
          width: (0, _elements.multiplySizeUnit)(size, 2)
        }
      };
    });
    var radius = (0, _vue.computed)(() => {
      var {
        size = '5.333vw'
      } = props;
      return (0, _elements.multiplySizeUnit)(size, 0.4);
    });

    var switchActive = event => {
      var {
        onClick,
        onChange,
        disabled,
        loading,
        readonly,
        modelValue,
        activeValue,
        inactiveValue,
        'onUpdate:modelValue': updateModelValue
      } = props;
      (0, _components.call)(onClick, event);
      if (disabled || loading || readonly || form != null && form.disabled.value || form != null && form.readonly.value) return;
      var newValue = modelValue === activeValue ? inactiveValue : activeValue;
      (0, _components.call)(onChange, newValue);
      (0, _components.call)(updateModelValue, newValue);
      validateWithTrigger();
    };

    var reset = () => {
      (0, _components.call)(props['onUpdate:modelValue'], props.inactiveValue);
      resetValidation();
    };

    var switchProvider = {
      reset,
      validate,
      resetValidation
    };
    (0, _components.call)(bindForm, switchProvider);
    return {
      n,
      classes,
      switchActive,
      radius,
      styleComputed,
      errorMessage,
      formDisabled: form == null ? void 0 : form.disabled,
      formReadonly: form == null ? void 0 : form.readonly
    };
  }

});

exports.default = _default;