"use strict";

exports.__esModule = true;
exports.default = exports._ActionSheetComponent = void 0;

var _ActionSheet = _interopRequireDefault(require("./ActionSheet.js"));

var _vue = require("vue");

var _shared = require("@varlet/shared");

var _components = require("../utils/components");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var singletonOptions;

function ActionSheet(options) {
  if (!(0, _shared.inBrowser)()) {
    return Promise.resolve();
  }

  return new Promise(resolve => {
    ActionSheet.close();
    var reactiveActionSheetOptions = (0, _vue.reactive)(options);
    reactiveActionSheetOptions.teleport = 'body';
    singletonOptions = reactiveActionSheetOptions;
    var {
      unmountInstance
    } = (0, _components.mountInstance)(_ActionSheet.default, reactiveActionSheetOptions, {
      onSelect: action => {
        reactiveActionSheetOptions.onSelect == null ? void 0 : reactiveActionSheetOptions.onSelect(action);
        resolve(action);
      },
      onClose: () => {
        reactiveActionSheetOptions.onClose == null ? void 0 : reactiveActionSheetOptions.onClose();
        resolve('close');
      },
      onClosed: () => {
        reactiveActionSheetOptions.onClosed == null ? void 0 : reactiveActionSheetOptions.onClosed();
        unmountInstance();
        singletonOptions === reactiveActionSheetOptions && (singletonOptions = null);
      },
      onRouteChange: () => {
        unmountInstance();
        singletonOptions === reactiveActionSheetOptions && (singletonOptions = null);
      },
      'onUpdate:show': value => {
        reactiveActionSheetOptions.show = value;
      }
    });
    reactiveActionSheetOptions.show = true;
  });
}

ActionSheet.Component = _ActionSheet.default;

_ActionSheet.default.install = function (app) {
  app.component(_ActionSheet.default.name, _ActionSheet.default);
};

ActionSheet.close = () => {
  if (singletonOptions != null) {
    var prevSingletonOptions = singletonOptions;
    singletonOptions = null;
    (0, _vue.nextTick)().then(() => {
      prevSingletonOptions.show = false;
    });
  }
};

ActionSheet.install = function (app) {
  app.component(_ActionSheet.default.name, _ActionSheet.default);
};

var _ActionSheetComponent = _ActionSheet.default;
exports._ActionSheetComponent = _ActionSheetComponent;
var _default = ActionSheet;
exports.default = _default;