"use strict";

exports.__esModule = true;
exports.default = void 0;
exports.render = render;

var _vue = require("vue");

var _elements = require("../utils/elements");

var _shared = require("@varlet/shared");

var _components = require("../utils/components");

var _provide = require("./provide");

var _props = require("./props");

var _icon = _interopRequireDefault(require("../icon"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var {
  n,
  classes
} = (0, _components.createNamespace)('collapse-item');

function render(_ctx, _cache) {
  var _component_var_icon = (0, _vue.resolveComponent)("var-icon");

  return (0, _vue.openBlock)(), (0, _vue.createElementBlock)("div", {
    class: (0, _vue.normalizeClass)(_ctx.classes(_ctx.n(), [_ctx.offset && _ctx.isShow, _ctx.n('--active')], [_ctx.disabled, _ctx.n('--disable')]))
  }, [(0, _vue.createElementVNode)("div", {
    class: (0, _vue.normalizeClass)(_ctx.n('header')),
    onClick: _cache[0] || (_cache[0] = $event => _ctx.toggle())
  }, [(0, _vue.createElementVNode)("div", {
    class: (0, _vue.normalizeClass)(_ctx.n('header-title'))
  }, [(0, _vue.renderSlot)(_ctx.$slots, "title", {}, () => [(0, _vue.createTextVNode)((0, _vue.toDisplayString)(_ctx.title), 1
  /* TEXT */
  )])], 2
  /* CLASS */
  ), (0, _vue.createElementVNode)("div", {
    class: (0, _vue.normalizeClass)(_ctx.n('header-icon'))
  }, [(0, _vue.renderSlot)(_ctx.$slots, "icon", {}, () => [(0, _vue.createVNode)(_component_var_icon, {
    name: _ctx.icon,
    transition: 250,
    class: (0, _vue.normalizeClass)(_ctx.classes(_ctx.n('header-icon'), [_ctx.isShow && _ctx.icon === 'chevron-down', _ctx.n('header-open')], [_ctx.disabled, _ctx.n('header--disable')]))
  }, null, 8
  /* PROPS */
  , ["name", "class"])])], 2
  /* CLASS */
  )], 2
  /* CLASS */
  ), (0, _vue.withDirectives)((0, _vue.createElementVNode)("div", {
    class: (0, _vue.normalizeClass)(_ctx.n('content')),
    ref: "contentEl",
    onTransitionend: _cache[1] || (_cache[1] = function () {
      return _ctx.transitionend && _ctx.transitionend(...arguments);
    }),
    onTransitionstart: _cache[2] || (_cache[2] = function () {
      return _ctx.start && _ctx.start(...arguments);
    })
  }, [(0, _vue.createElementVNode)("div", {
    class: (0, _vue.normalizeClass)(_ctx.n('content-wrap'))
  }, [(0, _vue.renderSlot)(_ctx.$slots, "default")], 2
  /* CLASS */
  )], 34
  /* CLASS, HYDRATE_EVENTS */
  ), [[_vue.vShow, _ctx.show]])], 2
  /* CLASS */
  );
}

var _default = (0, _vue.defineComponent)({
  render,
  name: 'VarCollapseItem',
  components: {
    VarIcon: _icon.default
  },
  props: _props.props,

  setup(props) {
    var {
      index,
      collapse,
      bindCollapse
    } = (0, _provide.useCollapse)();
    var isInitToTrigger = true; // ensure to trigger transitionend

    var contentEl = (0, _vue.ref)(null);
    var show = (0, _vue.ref)(false);
    var isShow = (0, _vue.ref)(false);
    var {
      active,
      offset,
      updateItem
    } = collapse;
    var name = (0, _vue.computed)(() => props.name);

    var init = (accordion, show) => {
      if (active.value === undefined || accordion && (0, _shared.isArray)(active.value) || show === isShow.value) return;
      isShow.value = show;
      toggle(true);
    };

    var toggle = initOrAccordion => {
      if (props.disabled) return;

      if (!initOrAccordion) {
        updateItem(props.name || index.value, !isShow.value);
      }
    };

    var openPanel = () => {
      if (!contentEl.value) return;
      contentEl.value.style.height = '';
      show.value = true;
      (0, _vue.nextTick)(() => {
        var {
          offsetHeight
        } = contentEl.value;
        contentEl.value.style.height = 0 + 'px';
        (0, _elements.requestAnimationFrame)(() => {
          ;
          contentEl.value.style.height = offsetHeight + 'px';
          if (!isInitToTrigger) return;
          (0, _elements.nextTickFrame)(() => {
            if (isInitToTrigger) transitionend();
          });
        });
      });
    };

    var start = () => {
      isInitToTrigger = false;
    };

    var closePanel = () => {
      if (!contentEl.value) return;
      var {
        offsetHeight
      } = contentEl.value;
      contentEl.value.style.height = offsetHeight + 'px';
      (0, _elements.requestAnimationFrame)(() => {
        ;
        contentEl.value.style.height = 0 + 'px';
      });
    };

    var transitionend = () => {
      if (!isShow.value) {
        show.value = false;
      }

      ;
      contentEl.value.style.height = '';
    };

    var collapseItemProvider = {
      index,
      name,
      init
    };
    bindCollapse(collapseItemProvider);
    (0, _vue.watch)(isShow, value => {
      if (value) openPanel();else closePanel();
    });
    return {
      n,
      start,
      classes,
      show,
      isShow,
      offset,
      toggle,
      contentEl,
      transitionend
    };
  }

});

exports.default = _default;