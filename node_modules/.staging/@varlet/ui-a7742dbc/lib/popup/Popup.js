"use strict";

exports.__esModule = true;
exports.default = void 0;

var _vue = require("vue");

var _props = require("./props");

var _lock = require("../context/lock");

var _zIndex = require("../context/zIndex");

var _components = require("../utils/components");





function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _isSlot(s) {
  return typeof s === 'function' || Object.prototype.toString.call(s) === '[object Object]' && !(0, _vue.isVNode)(s);
}

var {
  n,
  classes
} = (0, _components.createNamespace)('popup');

var _default = (0, _vue.defineComponent)({
  name: 'VarPopup',
  inheritAttrs: false,
  props: _props.props,

  setup(props, _ref) {
    var {
      slots,
      attrs
    } = _ref;
    var {
      zIndex
    } = (0, _zIndex.useZIndex)(() => props.show, 3);
    var {
      disabled
    } = (0, _components.useTeleport)();

    var hidePopup = () => {
      var _props$onUpdateShow;

      var {
        closeOnClickOverlay,
        onClickOverlay
      } = props;
      onClickOverlay == null ? void 0 : onClickOverlay();

      if (!closeOnClickOverlay) {
        return;
      }

      (_props$onUpdateShow = props['onUpdate:show']) == null ? void 0 : _props$onUpdateShow.call(props, false);
    };

    (0, _lock.useLock)(() => props.show, () => props.lockScroll);
    (0, _vue.watch)(() => props.show, newValue => {
      var {
        onOpen,
        onClose
      } = props;
      newValue ? onOpen == null ? void 0 : onOpen() : onClose == null ? void 0 : onClose();
    }); // internal for Dialog

    (0, _components.addRouteListener)(() => props.onRouteChange == null ? void 0 : props.onRouteChange());

    var renderOverlay = () => {
      var {
        overlayClass = '',
        overlayStyle
      } = props;
      return (0, _vue.createVNode)("div", {
        "class": classes(n('overlay'), overlayClass),
        "style": _extends({
          zIndex: zIndex.value - 1
        }, overlayStyle),
        "onClick": hidePopup
      }, null);
    };

    var renderContent = () => {
      return (0, _vue.createVNode)("div", (0, _vue.mergeProps)({
        "class": classes(n('content'), 'var-elevation--3', n("--" + props.position)),
        "style": {
          zIndex: zIndex.value
        }
      }, attrs), [slots.default == null ? void 0 : slots.default()]);
    };

    var renderPopup = () => {
      var {
        onOpened,
        onClosed,
        show,
        overlay,
        transition,
        position
      } = props;
      return (0, _vue.createVNode)(_vue.Transition, {
        "name": "var-fade",
        "onAfterEnter": onOpened,
        "onAfterLeave": onClosed
      }, {
        default: () => [(0, _vue.withDirectives)((0, _vue.createVNode)("div", {
          "class": classes('var--box', n()),
          "style": {
            zIndex: zIndex.value - 2
          }
        }, [overlay && renderOverlay(), (0, _vue.createVNode)(_vue.Transition, {
          "name": transition || "var-pop-" + position
        }, {
          default: () => [show && renderContent()]
        })]), [[_vue.vShow, show]])]
      });
    };

    return () => {
      var {
        teleport
      } = props;

      if (teleport) {
        var _slot;

        return (0, _vue.createVNode)(_vue.Teleport, {
          "to": teleport,
          "disabled": disabled.value
        }, _isSlot(_slot = renderPopup()) ? _slot : {
          default: () => [_slot]
        });
      }

      return renderPopup();
    };
  }

});

exports.default = _default;