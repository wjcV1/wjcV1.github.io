"use strict";

exports.__esModule = true;
exports.default = exports._ImagePreviewComponent = void 0;

var _ImagePreview = _interopRequireDefault(require("./ImagePreview.js"));

var _vue = require("vue");

var _shared = require("@varlet/shared");

var _components = require("../utils/components");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var singletonOptions;

function ImagePreview(options) {
  if (!(0, _shared.inBrowser)()) {
    return;
  }

  ImagePreview.close();
  var imagePreviewOptions = (0, _shared.isString)(options) ? {
    images: [options]
  } : (0, _shared.isArray)(options) ? {
    images: options
  } : options;
  var reactiveImagePreviewOptions = (0, _vue.reactive)(imagePreviewOptions);
  reactiveImagePreviewOptions.teleport = 'body';
  singletonOptions = reactiveImagePreviewOptions;
  var {
    unmountInstance
  } = (0, _components.mountInstance)(_ImagePreview.default, reactiveImagePreviewOptions, {
    onClose: () => reactiveImagePreviewOptions.onClose == null ? void 0 : reactiveImagePreviewOptions.onClose(),
    onClosed: () => {
      reactiveImagePreviewOptions.onClosed == null ? void 0 : reactiveImagePreviewOptions.onClosed();
      unmountInstance();
      singletonOptions === reactiveImagePreviewOptions && (singletonOptions = null);
    },
    onRouteChange: () => {
      unmountInstance();
      singletonOptions === reactiveImagePreviewOptions && (singletonOptions = null);
    },
    'onUpdate:show': value => {
      reactiveImagePreviewOptions.show = value;
    }
  });
  reactiveImagePreviewOptions.show = true;
}

ImagePreview.close = () => {
  if (singletonOptions != null) {
    var prevSingletonOptions = singletonOptions;
    singletonOptions = null;
    (0, _vue.nextTick)().then(() => {
      prevSingletonOptions.show = false;
    });
  }
};

_ImagePreview.default.install = function (app) {
  app.component(_ImagePreview.default.name, _ImagePreview.default);
};

ImagePreview.install = function (app) {
  app.component(_ImagePreview.default.name, _ImagePreview.default);
};

ImagePreview.Component = _ImagePreview.default;
var _ImagePreviewComponent = _ImagePreview.default;
exports._ImagePreviewComponent = _ImagePreviewComponent;
var _default = ImagePreview;
exports.default = _default;